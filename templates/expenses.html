{% extends 'landing.html' %}

{% block title %}
Analysis
{% endblock %}

{% block item %}
<input type="button" class="btn btn-primary" onclick="location.href='/enternew';" value="Add More Trans.">

<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

<style>
    ul.yes{height:200px; width:40%;}
    ul.yes{overflow:hidden; overflow-y:scroll;}


    ul.yes {
        position: relative;
        top: -20px;
  left: 20px;
  width: 480px;
  height: 200px;

  list-style-type: none;
  padding: 0;
  border: 1px solid #ddd;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  border-radius: 5px;
}

ul.yes li {
  padding: 8px 16px;
  border-bottom: 1px solid #ddd;
}

ul.yes li:last-child {
  border-bottom: none
}

form {
  display: inline-block;
}


div.startlineFilter {
  position: absolute;
  top: 930px;
  right: 1350px;
  width: 200px;
  height: 100px;
}

div.endlineFilter {
  position: absolute;
  top: 960px;
  right: 1350px;
  width: 200px;
  height: 100px;
}


div.buttonlineFilter {
  position: absolute;
  top: 945px;
  left: 300px;
  width: 200px;
  height: 100px;
}

label {
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  text-align: right;
  width: 400px;
  line-height: 26px;
  margin-bottom: 10px;
}

input.start_style {
  height: 25px;
  flex: 0 0 200px;
  margin-left: 10px;
}

input.end_style {
  height: 25px;
  flex: 0 0 200px;
  margin-left: 10px;
}


.cardLineChart {
  position: absolute;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  width: 70%;
  border-radius: 15px;
  left: 20px;
  top: 600px;
}

.cardPie {
    position: absolute;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  width: 20%;
  border-radius: 40px;
  right: 40px;
  top: 600px;
}

.scrollableActiviies{
position: absolute;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  width: 20%;
  border-radius: 40px;
  right: 40px;
}

.scrollableActivitiesFilter{
    position: relative;
    left: 35px;
}

.error {
    color: red
}

</style>

<br></br>


<div class = "scrollableActivitiesFilter">
    <form action = "{{ url_for('list') }}" method = "POST" >
     Start: <input type="date" name ="start_date_activity"> End: <input type="date" name = "end_date_activity"> <input type = "submit" value = "Filter"/>
    </form>
   </div>

   <br>

<div class = "scrollableActiviies">

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %} 
      <div>{{ message }}</div>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
{% block body %}{% endblock %}

</div>

      <br>

      <ul class = "yes">
        {% for row in rows %}
     <li>{{row["activity"]}} | ${{row["expense"]}} | {{row["created_at"]}} 
        <form action = "{{ url_for('delete_record', activity_id=row.expense_id) }}" method = "POST" style="float:right">
          <input type=submit name = 'delete' value="Delete">
      </form>
        <a href="edit_activity/{{row.expense_id}}" method = "POST" class="btn btn-default pull-right" style="float:right">Edit</a>
     </li>
        {% endfor %}
     </ul>


     
     <!--<table border = 1> 
         <thead>
            <td>ID</td>
            <td>Activity</td>
            <td>Expense</td>
            <td>Date</td>
            <td>Comment</td>
         </thead>
         
         {% for row in rows %}
            <tr>
               <td>{{row["expense_id"]}}</td>
               <td>{{row["activity"]}}</td>
               <td>{{row["expense"]}}</td>
               <td> {{row["created_at"]}}</td>
               <td>{{row['comment']}}</td>	
            </tr>
         {% endfor %}
      </table>
      -->



  <br></br>

      <canvas class = "cardLineChart" id="mylineChart" style="float:left;width:400%;max-width:600px"></canvas>
  
      <canvas class = "cardPie" id="mypieChart" style="float:right;width:100%;max-width:600px"></canvas>
      <br></br>


        
            <br>
            <div class="startlineFilter">
                <label>
      Start:  <input class = "start_style" type="date" id ="start_date"> 
                </label>
            </div>

            <div class="endlineFilter">
                <label>
      End:  <input class = "end_style" type="date" id = "end_date"> 
                </label>    
                </div>
            <div class="buttonlineFilter">
      <input type = "submit" name = "Filter" value = "Filter" onclick="lineFilter()"> <input type = "submit" name = "Reset" value = "Reset" onclick="lineResetFilter()">
            </div>
            </br>
       


 <p id="demo"></p>
  
<script  type="text/javascript">
var ctx1 = document.getElementById("mylineChart").getContext("2d");
var ctx2 = document.getElementById("mypieChart").getContext("2d");

var dateNew = {{dateNew|safe}};
//var data1 = {{data1|safe}};
var expenseInfo = {{expenseInfo|safe}};
var dff = {{expenseInfo|safe}};
var listExpense = {{listExpense|safe}};

var dfTimeSeriesExpense =  {{dfTimeSeriesExpense|safe}};

//["2022-08-1", "2022-08-2", "2022-08-8", "2022-08-16", "2022-08-17", "2022-08-31"]
var data = {
        labels: dateNew,
        datasets: [
            {
                label: "My First dataset",
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: dfTimeSeriesExpense
            }
        ]
    };


var canvas = document.getElementById('mylineChart');


function lineResetFilter(){
    data = {
        labels: dateNew,
        datasets: [
            {
                label: "My First dataset",
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: dfTimeSeriesExpense
            },
        ]
    };
    var myLineChart = new Chart(ctx1).Line(data);    

}

function lineFilter() {
    counter = 0;
    var newListDate = []
    var newListExpense = []
   // for i in listExpense:
   var start_date_input = document.getElementById("start_date").value;
    var end_date_input = document.getElementById("end_date").value;
   for (let i = 0; i < dateNew.length; i++) {
      if (dateNew[i] >= start_date_input && dateNew[i] <= end_date_input) {
        newListDate.push(dateNew[i]);
        newListExpense.push(dfTimeSeriesExpense[i])
      //  alert(newListExpense[i]);
       // alert(newListDate[i]);

// Then input a new data object, with form values as data
  data = {
        labels: newListDate,
        datasets: [
            {
                label: "My First dataset",
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: newListExpense
            },
        ]
    };
    var myLineChart = new Chart(ctx1).Line(data);

}
}
}

var myLineChart = new Chart(ctx1).Line(data);

 var pieData =[
            {
                label: "Bills & Utilities",
                color: "#46BFBD",
               highlight: "#5AD3D1",
                value: listExpense[0]
            },
            {
                label: "Entertainment",
                color: "#eb4034",
               highlight: "#FFC870",
                value: listExpense[1]
            },
            {
                label: "Food & Dining",
                color: "#34eb52",
               highlight: "#FFC870",
                value: listExpense[2]
            },
            {
                label: "Gass & Fuel",
                color: "#34ebb4",
               highlight: "#FFC870",
                value: listExpense[3]
            },
            {
                label: "Grocery",
                color: "#349beb",
               highlight: "#FFC870",
                value: listExpense[4]
            },
            {
                label: "Shopping",
                color: "#7434eb",
               highlight: "#FFC870",
                value: listExpense[5]
            },
            {
                label: "Traveling",
                color: "#cc34eb",
               highlight: "#FFC870",
                value: listExpense[6]
            }
        ];

    var option = {
        plugins:[ChartDataLabels],
        scales: {
    yAxes: [{
      scaleLabel: {
        display: true,
        labelString: 'probability'
      }
    }]
  }    
        
    };
var myPieChart = new Chart(ctx2).Pie(pieData, option);


/*

 datalabels: {
            formatter: (value, ctx2) => {
                
                return "hello";
            },
            color: '#fff',
        }
    }

*/


</script>

{% endblock %}
